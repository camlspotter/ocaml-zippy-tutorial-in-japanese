# OCaml と正規表現

## まず聞きたい。本当に正規表現が必要なのかと。

LL出身の方とかは文字列の処理というとすぐに正規表現を書き出すわけだが、一歩立ち止まって本当に正規表現が必要か考えてほしい。

正規表現を使う必要がないのに、正規表現しか知らないので正規表現を使ってしまっている場合。

正規表現でサッと書けない複雑な文法のパースを、正規表現しか知らないので正規表現を使ってしまっている場合。

前者は `String.index` と `String.sub` で済むだろ？みたいなコードを良く見るし、
それ以外にも Batteries や Core ならいろんな文字列操作の関数もあるのでそれを使ってほしい。

後者は Lex/Yacc とか Parsec 的な下降パーサを勉強してほしい。

## どのライブラリを使うべきか。

* Str はどこでも動く OCaml の正規表現として導入された POSIX 正規表現のライブラリ。外部ライブラリ非依存だが、古い。今やコンパイラソース内部で使えるライブラリが限られている、というシチュエーション以外、使う価値が無い。プロコン？主催者に他のを入れろと言いなさい。

* pcre-ocaml は libpcre の OCaml API。PCRE 大好きならこれ。ただし libpcre という外部ライブラリとリンクする必要があるので js_of_ocaml の様なシチュエーションでは使えない。

* ocaml-re は OCaml で書かれた正規表現ライブラリ。POSIX, Emacs, PCRE, glob という大体思い付く限りの正規表現をサポートするので今はこれがお勧め。ただし、OCaml で書かれているのでバイトコンパイルでは遅い。ネイティヴでは PCRE より速かったりするそうだ。ただし PCRE の back reference とかは使えないので注意が必要。(そんな複雑怪奇な正規表現を使うくらいなら、普通にパーサを書きなさいという話になる。)




