# OCaml での複数の同名モジュールのリンク


簡潔に言うと OCaml で複数の同名コンパイルユニットをリンクすることはできません。
(コンパイルユニットというのは x.ml などの分割コンパイルの対象となるトップレベル
モジュールの事です。)

実は、バイトコードではできます、がネイティブではできません。きょうび、
ネイティブでできないものを出来るとは言えないので、できないということになります。

ただ、ネイティブでも同名モジュールを複数リンクできるように見える場合があります。
これはライブラリアーカイブ cmxa を使った場合。アーカイブ中のモジュールは
全く参照されていない場合リンクから抜け落ちます。抜け落ちるので複数存在するように
見えてリンクされるものは実は一つなので問題がない、ということはある。
それでも、ちょっとしたプログラムが変更によって今まで参照されなかった cmxa の中の
モジュールが参照されるようになり、他の同名モジュールと衝突する、といった場合がある。

同名モジュールのリンク衝突を避ける方法に pack があります。A というモジュールが
他のライブラリと衝突している場合、P というパッケージのサブモジュール、つまり P.A に
する方法です。P というパッケージのためのモジュール名は他のパッケージとぶつからない
ユニークなものである必要があります。詳しくは、コンパイラの `-for-pack` と `-pack`
オプションを参照してください。

OCaml のライブラリは現在全てこのパッキングが行われていると期待してよいです。
してなければ文句を言うべき。例外は OCaml コンパイラソースに付属するライブラリです。
これは後方互換性のためもあるので特別な地位を持っている。

もひとつ。パッキングではなくて -no-alias-deps による特殊なライブラリアーカイブの
作り方をしているものが少数あります。が、これも、パッキングと同じく固有の名前を持つ
トップモジュールにサブモジュールが複数入っている形になっています。
